@startuml

' Configuration du style
skinparam classAttributeIconSize 0
skinparam class {
    BackgroundColor White
    ArrowColor Black
    BorderColor Black
}

' --- Énumérations ---
enum StatutAbonnement {
    ACTIF
    SUSPENDU
    RESILIE
    TERMINE
}

enum StatutSelection {
    BROUILLON
    VALIDEE
}

enum StatutBox {
    A_PREPARER
    EXPEDIEE
    LIVREE
}

enum FormatLivre {
    POCHE
    GRAND_FORMAT
}

enum GenreLitteraire {
    FANTASY
    POLAR
    HISTOIRE
    ROMANCE
    SF
}

' --- Classes Métier ---

class Client {
    - id : int
    - nom : String
    - prenom : String
    - email : String
    - adresseFacturation : String
    - adresseLivraison : String
    + sAbonner(formule : Formule)
    + demanderSuspension()
    + changerAdresse()
}

class Questionnaire {
    - genresAimes : List<GenreLitteraire>
    - genresDetestes : List<GenreLitteraire>
    - formatPrefere : FormatLivre
    + mettreAJour()
}

class Abonnement {
    - id : int
    - dateDebut : Date
    - dateFin : Date
    - statut : StatutAbonnement
    - renouvellementAuto : boolean
    + suspendre(duree : int)
    + resilier()
    + genererSelection()
}

class Formule {
    - id : int
    - nom : String
    - dureeMois : int
    - prixMensuel : float
}

class Libraire {
    - id : int
    - nom : String
    - specialite : GenreLitteraire
    + consulterProfil(client : Client)
    + validerSelection(sel : Selection)
}

class Selection {
    - id : int
    - dateCreation : Date
    - statut : StatutSelection
    - commentaireLibraire : String
    + ajouterLivre(livre : Livre)
    + validerChoix()
    + verifierSelectionComplete()
    + verifierCommentaireLibraire()
    + ajoutCommentaireLibraire()
    + récupérerLivres()
}

class ServiceLogistique {
    + recupererListeExpedition()
    + traiterBox(box : Box)
}

class Box {
    - id : int
    - numeroSuivi : String
    - dateExpedition : Date
    - statut : StatutBox
    + expedier()
    + preparer()
    + notifierClient()
    + ajouterLaSelectionALaBox()
}

class Livre {
    - isbn : String
    - titre : String
    - auteur : String
    - genre : GenreLitteraire
    - quantiteStock : int
    + verifierStock()
    + decrementerStock()
}

' --- Relations et Gestion des IDs ---

' 1. CLIENT & PROFIL
' Le Client pointe vers son questionnaire (client a questionnaire_id)
Client "1" --> "1" Questionnaire : possède >

' Le Questionnaire pointe vers les livres DEJA LUS (Table jointure questionnaire_livre_lu)
Questionnaire "1" --> "*" Livre : a déjà lu (exclure) >

' 2. ABONNEMENT
' L'Abonnement pointe vers le Client (abonnement a client_id)
Abonnement "*" --> "1" Client : appartient à >

' L'Abonnement pointe vers la Formule (abonnement a formule_id)
Abonnement "*" --> "1" Formule : utilise >

' 3. FLUX SELECTION / BOX
' La Sélection pointe vers l'Abonnement (selection a abonnement_id)
' (Pour retrouver le client et l'adresse via l'abonnement)
Abonnement "1" <-- "*" Selection : est générée pour <

' La Box COMPREND la Sélection (Composition forte)
' (La Box a selection_id, ou partage le même ID car 1-1)
Box "1" *-- "1" Selection : encapsule >

' La Sélection pointe vers les 2 Livres choisis (selection a livre_id_1, livre_id_2)
Selection "*" --> "2" Livre : contient >

' 4. ACTEURS
Libraire ..> Selection : valide >
ServiceLogistique ..> Box : traite >
Libraire -- "*" Client : suit >

@enduml